include: .gitlab/prelude.yml

service deploy:
  extends:
    - .tags
    - .environment
  image: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
  stage: run
  rules:
    - if: $CI_COMMIT_REF_PROTECTED
      when: manual
  script:
    - !reference [.prelude_kayobe_setup, script]
    - .automation/pipeline/overcloud-service-deploy.sh

host configure:
  extends:
    - .tags
    - .environment
  image: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
  stage: run
  rules:
    - if: $CI_COMMIT_REF_PROTECTED
      when: manual
  script:
    - !reference [.prelude_kayobe_setup, script]
    - .automation/pipeline/overcloud-host-configure.sh

container image pull:
  extends:
    - .tags
    - .environment-prepare
  image: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
  stage: run
  rules:
    - if: $CI_COMMIT_REF_PROTECTED
      when: manual
  script:
    - !reference [.prelude_kayobe_setup, script]
    - .automation/pipeline/overcloud-container-image-pull.sh
