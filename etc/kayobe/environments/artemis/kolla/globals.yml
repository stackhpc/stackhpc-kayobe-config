---
#Set backends for CloudKitty
cloudkitty_collector_backend: prometheus
cloudkitty_fetcher_backend: prometheus
cloudkitty_storage_backend: elasticsearch
{% raw %}
cloudkitty_prometheus_cafile: "{{ openstack_cacert }}"
cloudkitty_elasticsearch_cafile: "{{ openstack_cacert }}"
{% endraw %}

###############################################################################

# Internal TLS configuration
# Copy the self-signed CA into the kolla containers
kolla_copy_ca_into_containers: "yes"
# Use the following trust store within the container
openstack_cacert: "{{ '/etc/pki/tls/certs/ca-bundle.crt' if os_distribution == 'rocky' else '/etc/ssl/certs/ca-certificates.crt' }}"

# Backend TLS config
# Enable backend TLS
kolla_enable_tls_backend: "yes"

# If using RabbitMQ TLS:
rabbitmq_enable_tls: "yes"

# External API configuration.

# Expose all external API services on a single port.
{% raw %}
haproxy_single_external_frontend: true
kolla_external_fqdn: "{{ undef('Using HAProxy single external frontend - kolla_external_fqdn should not be required') }}"
base_external_fqdn: "artemis.sussex.ac.uk"
barbican_external_fqdn: "barbican.{{ base_external_fqdn }}"
cinder_external_fqdn: "cinder.{{ base_external_fqdn }}"
cloudkitty_external_fqdn: "cloudkitty.{{ base_external_fqdn }}"
designate_external_fqdn: "designate.{{ base_external_fqdn }}"
glance_external_fqdn: "glance.{{ base_external_fqdn }}"
grafana_external_fqdn: "grafana.{{ base_external_fqdn }}"
horizon_external_fqdn: "dashboard.{{ base_external_fqdn }}"
ironic_external_fqdn: "ironic.{{ base_external_fqdn }}"
ironic_inspector_external_fqdn: "ironic-inspector.{{ base_external_fqdn }}"
keystone_external_fqdn: "keystone.{{ base_external_fqdn }}"
manila_external_fqdn: "manila.{{ base_external_fqdn }}"
neutron_external_fqdn: "neutron.{{ base_external_fqdn }}"
nova_external_fqdn: "nova.{{ base_external_fqdn }}"
octavia_external_fqdn: "octavia.{{ base_external_fqdn }}"
opensearch_dashboards_external_fqdn: "opensearch-dashboards.{{ base_external_fqdn }}"
placement_external_fqdn: "placement.{{ base_external_fqdn }}"
prometheus_alertmanager_external_fqdn: "prometheus-alertmanager.{{ base_external_fqdn }}"
prometheus_external_fqdn: "prometheus.{{ base_external_fqdn }}"
{% endraw %}

enable_external_api_firewalld: true
external_api_firewalld_zone: "{{ public_net_name | net_zone }}"

# List of name server records, one for each controller
designate_ns_record:
  - "ns0.hrc.susx.ac.uk"
  - "ns1.hrc.susx.ac.uk"
  - "ns2.hrc.susx.ac.uk"

# NOTE: We are increasing the HAProxy timeouts to 5 minutes due to the neutron
# generic switch driver, which synchronously applies switch configuration for
# each ironic port during node provisioning and tear down.
# The specific API calls that require this long timeout are:
# - Creation and deletion of VLAN networks.
# - Creation or update of ports, adding binding information.
# - Update of ports, removing binding information.
# - Deletion of ports.
haproxy_client_timeout: 5m30
haproxy_server_timeout: 5m30
neutron_tls_proxy_client_timeout: 5m30
neutron_tls_proxy_server_timeout: 5m30
