---

# Dict mapping Jinja2 block names in kolla's Docker images to their contents.
kolla_build_blocks:
  bifrost_footer: |
    RUN /var/lib/kolla/venv/bin/pip install --cert /etc/pki/tls/cert.pem stackhpc-inspector-plugins==1.1.1
#  horizon_footer: |
#    ADD https://object.vss.cloud.cam.ac.uk/swift/v1/AUTH_4a8139220b424e7d810a3cf364a89ee2/arcus-images/logo-splash.svg /usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo-splash.svg
#    ADD https://object.vss.cloud.cam.ac.uk/swift/v1/AUTH_4a8139220b424e7d810a3cf364a89ee2/arcus-images/favicon.ico /usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/favicon.ico
#    ADD https://object.vss.cloud.cam.ac.uk/swift/v1/AUTH_4a8139220b424e7d810a3cf364a89ee2/arcus-images/logo.svg /usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo.svg
  neutron_server_footer: |
    RUN /var/lib/kolla/venv/bin/pip install --cert /etc/pki/tls/cert.pem git+https://github.com/RSE-Cambridge/networking-generic-switch@cumulus-train-2 -c https://releases.openstack.org/constraints/upper/train
    RUN /var/lib/kolla/venv/bin/pip install --cert /etc/pki/tls/cert.pem etcd3gw
  prometheus_server_repository_version: |
    # Avoid the pain of porting 1.x rules and migrating data to 2.x
    ARG prometheus_version='2.8.0'
  prometheus_cadvisor_repository_version: |
    ENV prometheus_cadvisor_version=0.35.0
  ironic_inspector_footer: |
    # Install our custom inspector plugins.
    RUN /var/lib/kolla/venv/bin/pip install --cert /etc/pki/tls/cert.pem  stackhpc-inspector-plugins==1.1.1
  keystone_footer: |
    RUN yum remove -y mod_auth_openidc
    RUN rpm -i https://github.com/zmartzone/mod_auth_openidc/releases/download/v2.4.0/cjose-0.6.1.5-2.el7.x86_64.rpm
    RUN rpm -i https://github.com/zmartzone/mod_auth_openidc/releases/download/v2.4.0/mod_auth_openidc-2.4.0-1.el7.x86_64.rpm
  nova_base_footer: |
    RUN /var/lib/kolla/venv/bin/pip install --prefix /var/lib/kolla/venv --cert /etc/pki/tls/cert.pem -U --no-deps git+https://github.com/stackhpc/nova.git@jg-ironic-rebalance-sync-2022-05-12 -c https://releases.openstack.org/constraints/upper/train
  manila_share_footer: |
    RUN yum erase -y ceph-common.x86_64 libbabeltrace.x86_64 libcephfs2.x86_64 librados2.x86_64 libradosstriper1.x86_64 librbd1.x86_64 librgw2.x86_64 lttng-ust.x86_64 python2-prettytable.noarch python-ceph-argparse.x86_64 python-cephfs.x86_64 python-rados.x86_64 python-rbd.x86_64 python-rgw.x86_64 userspace-rcu.x86_64 || true
    RUN yum erase -y centos-release-ceph-nautilus
    RUN yum install -y centos-release-ceph-luminous
    RUN yum install -y ceph-common.x86_64 libbabeltrace.x86_64 libcephfs2.x86_64 librados2.x86_64 libradosstriper1.x86_64 librbd1.x86_64 librgw2.x86_64 lttng-ust.x86_64 python-cephfs.x86_64 python-logutils.noarch python-rados.x86_64 python-rbd.x86_64 python-rgw.x86_64 userspace-rcu.x86_64

# Dict mapping image customization variable names to their values.
# Each variable takes the form:
# <image name>_<customization>_<operation>
# Hyphens in the image name are replaced with underscores. The customization is
# most commonly packages. The operation should be one of override, append or
# remove. The value should be a list.
kolla_build_customizations:
  bifrost_packages_append:
    - 'jq'
  keystone_packages_append:
    # Allow custom packages to be installed via pip.
    # Allow manual install of openidc for federation
    - 'jansson-devel'
    - 'openssl-devel'
    - 'hiredis'
  neutron_server_packages_append:
    # Allow custom packages to be installed via pip.
    - 'gcc'
    - 'python-devel'

# Disable magnum build due to:
# INFO:kolla.common.utils.magnum-api:ESC[91mERROR: Package 'magnum' requires a different Python: 2.7.5 not in '>=3.6'
# Workaround: Use centos8s version.
kolla_enable_magnum: false
