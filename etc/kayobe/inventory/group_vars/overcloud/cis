---
##############################################################################
# RHEL 8 / Centos Stream 8 CIS Hardening Configuration

# NOTE: kayobe configures NTP. Do not clobber configuration.
rhel8cis_time_synchronization: skip
rhel8cis_rule_2_2_1_1: false
rhel8cis_rule_2_2_1_2: false

# NOTE: disable CIS rolefirewall configuration
rhel8cis_firewall: skip
rhel8cis_rule_3_4_1_1: false

# NOTE: kayobe does not currently support selinux
rhel8cis_selinux_disable: true

# NOTE: This updates the system. Let's do this explicitly.
rhel8cis_rule_1_9: false

# NOTE: FUTURE breaks wazuh agent repo metadata download
rhel8cis_crypto_policy: FIPS

# NOTE: We will remove /etc/motd instead. This prevents a duplicate warning
# from being displayed.
rhel8cis_rule_1_8_1_1: false
rhel8cis_rule_1_8_1_4: false

##############################################################################
# Rocky 9 CIS Hardening Configuration

# Allow IP forwarding
rhel9cis_is_router: true

# Skip configuration of chrony
rhel9cis_rule_2_1_1: false
rhel9cis_rule_2_1_2: false

# Skip configuration of the firewall
rhel9cis_firewall: None
rhel9cis_rule_3_4_1_2: false

# Don't configure selinux
rhel9cis_selinux_disable: true

# NOTE: FUTURE breaks wazuh agent repo metadata download
rhel9cis_crypto_policy: FIPS

# Skip package updates
rhel9cis_rule_1_9: false

# Disable requirement for password when using sudo
rhel9cis_rule_5_3_4: false

##############################################################################
# Ubuntu Jammy CIS Hardening Configuration

# Ubuntu 22 CIS configuration
# Disable changing routing rules
ubtu22cis_is_router: true

# Set Chrony as the time sync tool
ubtu22cis_time_sync_tool: "chrony"

# Disable CIS from configuring the firewall
ubtu22cis_firewall_package: "none"

# Stop CIS from installing Network Manager
ubtu22cis_install_network_manager: false

# Set syslog service to journald
ubtu22cis_syslog_service: journald

# Squashfs is compiled into the kernel
ubtu22cis_rule_1_1_1_2: false

# This updates the system. Let's do this explicitly.
ubtu22cis_rule_1_9: false

# Do not change Chrony Time servers
ubtu22cis_rule_2_1_2_1: false

# Disable CIS from touching sudoers
ubtu22cis_rule_5_3_4: false

# Add stack and kolla to allowed ssh users
ubtu22cis_sshd:
    log_level: "INFO"
    max_auth_tries: 4
    ciphers: "chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr"
    macs: "hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256"
    kex_algorithms: "curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256"
    client_alive_interval: 300
    client_alive_count_max: 3
    login_grace_time: 60
    max_sessions: 10
    allow_users: "kolla stack ubuntu"
    allow_groups: "kolla stack ubuntu"
    # This variable, if specified, configures a list of USER name patterns, separated by spaces, to prevent SSH access
    # for users whose user name matches one of the patterns. This is done
    # by setting the value of `DenyUsers` option in `/etc/ssh/sshd_config` file.
    # If an USER@HOST format will be used, the specified user will be restricted only on that particular host.
    # The allow/deny directives process order: DenyUsers, AllowUsers, DenyGroups, AllowGroups.
    # For more info, see https://linux.die.net/man/5/sshd_config
    deny_users: ""
    # This variable, if specified, configures a list of GROUP name patterns, separated by spaces, to prevent SSH access
    # for users whose primary group or supplementary group list matches one of the patterns. This is done
    # by setting the value of `DenyGroups` option in `/etc/ssh/sshd_config` file.
    # The allow/deny directives process order: DenyUsers, AllowUsers, DenyGroups, AllowGroups.
    # For more info, see https://linux.die.net/man/5/sshd_config
    deny_groups: ""

# Do not change /var/lib/docker permissions
ubtu22cis_no_group_adjust: false
ubtu22cis_no_owner_adjust: false

# Enable collecting auditd logs
update_audit_template: true

# Configure log rotation to prevent audit logs from filling the disk
ubtu22cis_auditd:
    action_mail_acct: root
    space_left_action: syslog
    admin_space_left_action: halt
    max_log_file_action: rotate

# Disable grub bootloader password. Requires overriding
# ubtu22cis_bootloader_password_hash
ubtu22cis_rule_1_4_1: false
ubtu22cis_rule_1_4_3: false

##############################################################################
