---
# Add extra Kolla global configuration here.

# Tell kolla to use the extra volume in this location
nova_instance_datadir_volume: '/var/lib/nova'

# Ceph integration, without nova having rbd backend
cinder_backend_ceph: "{{ scientific_openstack_trait_ceph }}"

# Make glance use a file backend
glance_backend_swift: "no"
glance_file_backend: "yes"

# Enable CADF notifications in Keystone
enable_cadf_notifications: "yes"

# add route to ceph-rgw group in haproxy
enable_ceph_rgw: "{{ scientific_openstack_trait_ceph }}"
# Produce a list of radosgw endpoints e.g ['192.168.1.4:6780']
ceph_rgw_hosts: "{{ groups['ceph-rgw'] | default([]) | map('extract', hostvars, 'ansible_host') | select('defined') | map('regex_replace', '^(.*)$', '\\1:6780') | list  }}"

# Projects to extracts metrics from with cASO
#caso_projects:
#  - iris
#  - iris-euclid
caso_messengers:
  - caso.messenger.logstash.LogstashMessenger
  - caso.messenger.ssm.SSMMessengerV04
caso_site_name: "CHANGE_ME_CASO_SITE_NAME"

# Designate (DNSaaS) configuration
designate_backend: "bind9"
designate_ns_record: "CHANGEME_DESIGNATE_NS_RECORD"

# Container image tags.
# These should be allowed to change independently, as services are updated.
barbican_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
bifrost_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
blazar_tag: "wallaby-20220330T121740{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
caso_tag: "wallaby-20220330T121740{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
ceph_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
chrony_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
cinder_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
cron_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
designate_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
elasticsearch_curator_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
elasticsearch_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
fluentd_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
glance_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
grafana_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
haproxy_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
heat_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
horizon_tag: "wallaby-20220329T211158{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
influxdb_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
ironic_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
iscsid_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
kafka_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
keepalived_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
keystone_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
kibana_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
kolla_toolbox_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
logstash_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
magnum_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
manila_tag: "wallaby-20220116T211329{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
mariadb_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
memcached_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
monasca_notification_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
monasca_persister_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
monasca_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
neutron_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
nova_tag: "wallaby-20220329T211158{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
octavia_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
openvswitch_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
ovn_tag: "wallaby-20220321T145013{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
placement_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_cadvisor_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_elasticsearch_exporter_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_jiralert_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_libvirt_exporter_tag: "wallaby-20220329T211158{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_mtail_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_openstack_exporter_tag: "wallaby-20220331T043602{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_server_tag: "wallaby-20211228T180359{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
prometheus_tag: "wallaby-20211228T180359{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
rabbitmq_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
redis_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
storm_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
zookeeper_tag: "wallaby-20211213T174142{% raw %}{{ openstack_tag_suffix }}{% endraw %}"

# Default size causes ES to fall over very easily
{% if scientific_openstack_trait_all_in_one %}
es_heap_size: 8g
{% else %}
es_heap_size: "24g"
{% endif %}

# Look after elasticserach indexes, as required
enable_elasticsearch_curator: true
# Close index after 30 days
elasticsearch_curator_soft_retention_period_days: 30
# Hard delete index after around 3 years
elasticsearch_curator_hard_retention_period_days: 1100

# Takes longer than the default 10 seconds, we poll every 1m
prometheus_openstack_exporter_timeout: 30s

# Needed to launch VM instances in aio environment without nested virt
nova_compute_virt_type: "{{ 'qemu' if scientific_openstack_trait_all_in_one else 'kvm' }}"

# Increase the default prometheus retention period
prometheus_cmdline_extras: '--storage.tsdb.retention.time=90d --storage.tsdb.retention.size=50GB'

# Reduce the kolla-ansible token expiry default from one day to one hour
fernet_token_expiry: 3600

# Custom exporters
enable_prometheus_libvirt_exporter: True

# Using gitlab registry with TLS
docker_registry_insecure: false

{% if scientific_openstack_trait_all_in_one %}
keepalived_vip_prechecks: false
{% endif %}

{% if scientific_openstack_trait_ovn %}
neutron_plugin_agent: 'ovn'
{% endif %}
