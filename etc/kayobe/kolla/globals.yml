---
# Add extra Kolla global configuration here.

# Default size causes ES to fall over very easily
{% if scientific_openstack_trait_all_in_one %}
es_heap_size: 8g
{% else %}
es_heap_size: "24g"
{% endif %}

# Backport of: https://review.opendev.org/c/openstack/kolla-ansible/+/824994
# Upstream version isbackported to Victoria.
rabbitmq_remove_ha_all_policy: true

# Needed to launch VM instances in aio environment without nested virt
nova_compute_virt_type: "{{ 'qemu' if scientific_openstack_trait_all_in_one else 'kvm' }}"

# Using gitlab registry with TLS
docker_registry_insecure: false

{% if scientific_openstack_trait_all_in_one %}
keepalived_vip_prechecks: false
{% endif %}

{% if scientific_openstack_trait_ovn %}
neutron_plugin_agent: 'ovn'
{% endif %}

libvirt_enable_sasl: true

{% raw %}
# These are copied from the baremetal role.
docker_yum_baseurl_default: "{{ docker_yum_url }}/$releasever/$basearch/stable"
docker_yum_gpgkey_default: "{{ docker_yum_url }}/gpg"
{% endraw %}

docker_yum_baseurl_redhat8: "{{ stackhpc_repo_docker_url }}"
docker_yum_gpgkey_redhat8: "https://download.docker.com/linux/centos/gpg"

{% raw %}
docker_yum_baseurl: "{{ lookup('vars', 'docker_yum_baseurl_' ~ ansible_facts.os_family | lower ~ ansible_facts.distribution_major_version, default=docker_yum_baseurl_default) }}"
docker_yum_gpgkey: "{{ lookup('vars', 'docker_yum_gpgkey_' ~ ansible_facts.os_family | lower ~ ansible_facts.distribution_major_version, default=docker_yum_gpgkey_default) }}"
{% endraw %}

# Disable kolla managed NTP clients
enable_chrony: false
enable_host_ntp: false

# OpenStack Train: CentOS 7 to Rocky Linux 8 compatability
rabbitmq_use_3_7_24_on_centos7: true
elasticsearch_use_v6: true
kibana_use_v6: true

# This is templated on localhost, so use raw tags.
enable_nova_libvirt_container: "{% raw %}{{ ansible_facts.os_family == 'RedHat' and ansible_facts.distribution_major_version | int == 7 }}{% endraw %}"

# Custom container image tags.
# These should be allowed to change independently, as services are updated.
# Always use centos8s Magnum as ussuri build on centos 7 is broken:
# # INFO:kolla.common.utils.magnum-api:ESC[91mERROR: Package 'magnum' requires a different Python: 2.7.5 not in '>=3.6'
magnum_tag: "{{ kolla_openstack_release }}-centos8s"
etcd_tag: "train-20220623163725{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
bifrost_tag: "train-20220629102527{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
neutron_server_tag: "train-20220629102527{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
nova_tag: "train-20220909165719{% raw %}{{ openstack_tag_suffix }}{% endraw %}"
