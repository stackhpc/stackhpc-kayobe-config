# yamllint disable-file
---

# kolla_base_distro must be set here to be resolvable on a per-host basis
# This is necessary for os migrations where mixed clouds might be deployed
kolla_base_distro: "{% raw %}{{ ansible_facts.distribution | lower }}{% endraw %}"

kayobe_image_tags:
  openstack:
    rocky: 2023.1-rocky-9-20231011T200357
    ubuntu: 2023.1-ubuntu-jammy-20231011T200357
  bifrost:
    rocky: 2023.1-rocky-9-20231228T140806
    ubuntu: 2023.1-ubuntu-jammy-20231228T140806
  cloudkitty:
    rocky: 2023.1-rocky-9-20231115T110235
    ubuntu: 2023.1-ubuntu-jammy-20231115T110235
  haproxy-ssh:
    rocky: 2023.1-rocky-9-20240104T071640
    ubuntu: 2023.1-ubuntu-jammy-20240104T071640
  letsencrypt:
    rocky: 2023.1-rocky-9-20240104T071640
    ubuntu: 2023.1-ubuntu-jammy-20240104T071640
  neutron:
    rocky: 2023.1-rocky-9-20231220T222020
    ubuntu: 2023.1-ubuntu-jammy-20231220T222020
  nova:
    rocky: 2023.1-rocky-9-20231220T222020
    ubuntu: 2023.1-ubuntu-jammy-20231220T222020
  octavia:
    rocky: 2023.1-rocky-9-20231220T222020
    ubuntu: 2023.1-ubuntu-jammy-20231220T222020
  opensearch:
    rocky: 2023.1-rocky-9-20231214T151917
    ubuntu: 2023.1-ubuntu-jammy-20231214T151917

openstack_tag: "{% raw %}{{ kayobe_image_tags['openstack'][kolla_base_distro] }}{% endraw %}"
bifrost_tag: "{% raw %}{{ kayobe_image_tags['bifrost'][kolla_base_distro] }}{% endraw %}"
cloudkitty_tag: "{% raw %}{{ kayobe_image_tags['cloudkitty'][kolla_base_distro] }}{% endraw %}"
haproxy_ssh_tag: "{% raw %}{{ kayobe_image_tags['haproxy-ssh'][kolla_base_distro] }}{% endraw %}"
letsencrypt_tag: "{% raw %}{{ kayobe_image_tags['letsencrypt'][kolla_base_distro] }}{% endraw %}"
neutron_tag: "{% raw %}{{ kayobe_image_tags['neutron'][kolla_base_distro] }}{% endraw %}"
nova_tag: "{% raw %}{{ kayobe_image_tags['nova'][kolla_base_distro] }}{% endraw %}"
octavia_tag: "{% raw %}{{ kayobe_image_tags['octavia'][kolla_base_distro] }}{% endraw %}"
opensearch_tag: "{% raw %}{{ kayobe_image_tags['opensearch'][kolla_base_distro] }}{% endraw %}"

om_enable_rabbitmq_high_availability: true

#############################################################################
# Monitoring and alerting related settings

opensearch_heap_size: 8g
prometheus_cmdline_extras: "--storage.tsdb.retention.time=30d"

# Additional command line flags for node exporter to enable texfile collector for disk metrics and create textfile docker volume
prometheus_node_exporter_extra_volumes:
  - "textfile:/var/lib/node_exporter/textfile_collector"
prometheus_node_exporter_cmdline_extras: "--collector.textfile.directory=/var/lib/node_exporter/textfile_collector"

# Set Ceph manager exporter endpoints
{% if groups['mgrs'] | length > 0 %}
prometheus_ceph_mgr_exporter_endpoints:
{% for host in groups['mgrs'] %}
  - "{{ admin_oc_net_name | net_ip(host) }}:9283"
{% endfor %}
{% endif %}

# Use inventory hostnames as labels
prometheus_instance_label: "{% raw %}{{ ansible_facts.hostname }}{% endraw %}"

# Make openstack-exporter use Nova API version 2.1 to keep metrics the same as
# in Yoga. This is required to include a valid value for the flavor_id label on
# openstack_nova_server_status metrics.
prometheus_openstack_exporter_compute_api_version: "2.1"
