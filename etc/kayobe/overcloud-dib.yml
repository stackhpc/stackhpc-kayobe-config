---

overcloud_dib_build_host_images: True
overcloud_dib_os_element: centos-minimal

overcloud_dib_elements_extra:
  - block-device-efi
  - cloud-init
  - dracut-regenerate
  - openssh-server

overcloud_dib_packages:
  - net-tools
  - logrotate

overcloud_dib_env_vars_extra:
  DIB_RELEASE: 8-stream
  YUM: dnf
  DIB_DRACUT_ENABLED_MODULES_DEFAULT_CONFIG:
    - name: crypt
      packages:
        - cryptsetup
    - name: lvm
      packages:
        - lvm2
    - name: mdraid
      packages:
        - mdraid
  DIB_BOOTLOADER_DEFAULT_CMDLINE: "nofb nomodeset gfxpayload=text net.ifnames=1 rd.auto"
  DIB_BLOCK_DEVICE_CONFIG: |
    - local_loop:
        name: image0
        size: 20GiB
    - partitioning:
        base: image0
        label: gpt
        partitions:
          - name: ESP
            type: 'EF00'
            size: 550MiB
            mkfs:
              type: vfat
              mount:
                mount_point: /boot/efi
                fstab:
                  options: "defaults"
                  fsck-passno: 2
          - name: BSP
            type: 'EF02'
            size: 8MiB
          - name: root
            type: '8E00'
            flags: [ boot ]
            size: 100%
    - lvm:
        name: lvm
        base: [ root ]
        pvs:
          - name: rootpv
            base: root
            options: [ "--force" ]
        vgs:
          - name: rootvg
            base: [ "rootpv" ]
            options: [ "--force" ]
        lvs:
          - name: lv_root
            base: rootvg
            size: 5G
          - name: lv_tmp
            base: rootvg
            size: 1G
          - name: lv_var
            base: rootvg
            size: 1G
          - name: lv_var_tmp
            base: rootvg
            size: 1G
          - name: lv_log
            base: rootvg
            size: 1G
          - name: lv_audit
            base: rootvg
            size: 128M
          - name: lv_home
            base: rootvg
            size: 128M
    - mkfs:
        name: fs_root
        base: lv_root
        type: ext4
        label: "rootfs"
        mount:
          mount_point: /
          fstab:
            options: "defaults"
            fsck-passno: 1
    - mkfs:
        name: fs_tmp
        base: lv_tmp
        type: ext4
        label: "tmpfs"
        mount:
          mount_point: /tmp
          fstab:
            options: "rw,noexec,nosuid,nodev"
            fsck-passno: 2
    - mkfs:
        name: fs_var
        base: lv_var
        type: ext4
        label: "varfs"
        mount:
          mount_point: /var
          fstab:
            options: "defaults"
            fsck-passno: 2
    - mkfs:
        name: fs_var_tmp
        base: lv_var_tmp
        type: ext4
        label: "vartmpfs"
        mount:
          mount_point: /var/tmp
          fstab:
            options: "rw,noexec,nosuid,nodev"
            fsck-passno: 2
    - mkfs:
        name: fs_log
        base: lv_log
        type: ext4
        label: "logfs"
        mount:
          mount_point: /var/log
          fstab:
            options: "defaults"
            fsck-passno: 2
    - mkfs:
        name: fs_audit
        base: lv_audit
        type: ext4
        label: "auditfs"
        mount:
          mount_point: /var/log/audit
          fstab:
            options: "defaults"
            fsck-passno: 2
    - mkfs:
        name: fs_home
        base: lv_home
        type: ext4
        label: "homefs"
        mount:
          mount_point: /home
          fstab:
            options: "rw,nodev"
            fsck-passno: 2
